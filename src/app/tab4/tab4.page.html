<app-header></app-header>

<ion-content>
  <div class="ion-text-center ion-margin-top">
    <h5>{{ client_name }}</h5>
  </div>

  <ion-list>
    <ion-item>
      <ion-icon
        aria-hidden="true"
        name="business-outline"
        slot="start"
      ></ion-icon>
      <ion-label>Planta: {{ subsidiary_id}}</ion-label>
    </ion-item>
    <ion-item>
      <ion-icon
        aria-hidden="true"
        name="filter-circle-outline"
        slot="start"
      ></ion-icon>
      <ion-label> {{ subject }} </ion-label>
    </ion-item>
    <ion-item>
      <!-- <ion-icon aria-hidden="true" name="cube-outline" slot="start"></ion-icon> -->
      <!-- <ion-label>Cinturón: {{ 'B' }}</ion-label> -->
    </ion-item>
    <ion-item>
      <ion-icon
        aria-hidden="true"
        name="person-outline"
        slot="start"
      ></ion-icon>
      <ion-label>Responsable: {{ responsible }}</ion-label>
    </ion-item>
    <ion-item>
      <ion-icon aria-hidden="true" name="star-outline" slot="start"></ion-icon>
      <ion-label>Estado: {{ status }}</ion-label>
    </ion-item>
    <ion-item>
      <ion-icon
        aria-hidden="true"
        name="calendar-clear-outline"
        slot="start"
      ></ion-icon>
      <ion-label>Fecha de inicio: {{ start_date }}</ion-label>
    </ion-item>
    <ion-item>
      <ion-icon
        aria-hidden="true"
        name="calendar-outline"
        slot="start"
      ></ion-icon>
      <!-- <ion-label>Fecha de cierre: {{ '18/01/2024' }}</ion-label> -->
    </ion-item>
    <ion-item>
      <ion-icon aria-hidden="true" name="flash-outline" slot="start"></ion-icon>
      <ion-label>Prioridad: {{ priority }}</ion-label>
    </ion-item>
  </ion-list>
  <div>
    <ion-item>
      <ion-grid>
        <h6>Descripción:</h6>
        <p>{{description}}</p>
      </ion-grid>
    </ion-item>
  </div>

  <!-- <ion-grid>
    <ion-row class="ion-align-items-center ion-justify-content-around">
      <ion-col size="6" class="ion-text-center">
        <img
          nzDisablePreview="true"
          nz-image
          width="120px"
          nzSrc="https://st.depositphotos.com/1529768/2471/i/450/depositphotos_24718891-stock-photo-enclosed-rat-trap-safety-poison.jpg"
          alt=""
        />
      </ion-col>
      <ion-col size="6" class="ion-text-center">
        <img
          nzDisablePreview="true"
          nz-image
          width="120px"
          nzSrc="https://www.birdgard.es/650-home_default/trampas-para-ratones-set-de-2.jpg"
          alt=""
        />
      </ion-col>
    </ion-row>
  </ion-grid> -->
  <ion-item>
    <ion-grid>
      <ion-label>Comentarios</ion-label>
      <div
        *ngFor="let response of tickets_responses"
        style="margin-bottom: 20px"
      >
        <nz-card nzHoverable style="width: 240px" [nzCover]="coverTemplate">
          <nz-card-meta
            nzTitle="{{response.firstname}} {{response.lastname}}"
            nzDescription="{{response.message}}"
          ></nz-card-meta>
        </nz-card>
        <ng-template #coverTemplate>
          <img alt="example" src="{{response.file_name}}" />
        </ng-template>
      </div>
    </ion-grid>
  </ion-item>

  <div *ngIf="userdata.role  !== '4' || userdata.role !== '7'; else noItems">
    <ion-item>
      <ion-item>
        <ion-grid>
          <ion-label>Añadir archivos</ion-label>
          <ion-col size="12" class="ion-justify-content-center">
            <img *ngIf="evidenceImageTicket" [src]="evidenceImageTicket" />
            <ion-button expand="block" (click)="takePictureTicket()"
              >Agregar foto</ion-button
            >
          </ion-col>
        </ion-grid>
      </ion-item>
    </ion-item>
    <form
      nz-form
      [formGroup]="commentForm"
      (ngSubmit)="updateCommet()"
      class="form-evidence"
    >
      <div>
        <ion-item>
          <ion-col size="12">
            <ion-label>Comentarios:</ion-label>
            <textarea
              id="commentArea"
              required="true"
              formControlName="comment"
              rows="4"
              col="30"
              nz-input
              [(ngModel)]="inputValue"
            ></textarea>
          </ion-col>
        </ion-item>
      </div>
      <ion-item>
        <ion-col class="ion-text-end" slot="end">
          <ion-button
            shape="round"
            id="document-modal"
            (click)="onSubmit()"
            [disabled]="!commentForm.valid"
            >Agregar evidencia</ion-button
          >
        </ion-col>
      </ion-item>
      <!-- <ion-item>
        <ion-col>
          <p>Form Value: {{ commentForm.value | json }}</p>
          <p>Form Status: {{ commentForm.status }}</p>
        </ion-col>
      </ion-item> -->
    </form>
  </div>
  <ng-template #noItems class="list-item">
    <ion-item>
      <ion-col class="ion-text-end" slot="end">
        <ion-button
          shape="round"
          id="document-modal"
          (click)="onSubmit()"
          [disabled]="!commentForm.valid"
          >Cerrar ticket</ion-button
        >
      </ion-col>
    </ion-item>
  </ng-template>
</ion-content>

<!-- Modal -->
<ion-modal animated="true" keyboardClose="true" id="myModal">
  <ion-header>
    <!-- ... (cabecera del modal) ... -->
  </ion-header>
  <ion-content>
    <!-- Contenido del modal (progreso, checkbox, comentarios, etc.) -->
  </ion-content>
</ion-modal>
